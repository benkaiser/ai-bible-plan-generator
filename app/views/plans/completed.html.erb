<h1 class="mb-4">Completed Plans</h1>

<% if @completed_plan_instance_users.any? %>
  <div class="mb-5">
    <div class="row">
      <% @completed_plan_instance_users.each do |plan_instance_user| %>
        <div class="col-md-4">
          <div class="card mb-4">
            <% unless plan_instance_user.plan_instance.plan.cover_photo.empty? %>
              <a href="<%= plan_instance_path(plan_instance_user.plan_instance) %>">
                <img src="<%= plan_instance_user.plan_instance.plan.cover_photo %>/400/200"
                  class="card-img-top bg-dark"
                  alt="Plan cover photo"
                />
              </a>
            <% end %>
            <div class="card-body">
              <h5 class="card-title"><%= plan_instance_user.plan_instance.plan.name %></h5>
              <p class="card-text"><%= plan_instance_user.plan_instance.plan.description %></p>
              <% if plan_instance_user.other_users.any? %>
                <p class="card-text">
                  Reading with:
                    <% plan_instance_user.other_users.each do |user| %>
                      <span class="badge bg-info me-1">
                        <i class="bi bi-person-fill me-1"></i>
                        <%= user.username %></span>
                      </span>
                    <% end %>
                </p>
              <% end %>
              <p class="card-text"><small class="text-muted">Started on: <%= plan_instance_user.plan_instance.start_date.strftime("%b %d, %Y") %></small></p>
              <p class="card-text"><small class="text-muted">Completed on: <%= plan_instance_user.completed_at.strftime("%b %d, %Y") %></small></p>
              <%= link_to 'View Plan', plan_instance_path(plan_instance_user.plan_instance), class: 'btn btn-primary' %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% else %>
  <p>No completed plans found.</p>
<% end %>