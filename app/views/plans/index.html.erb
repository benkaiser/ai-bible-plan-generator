<h1 class="mb-4">Plans</h1>

<div class="d-flex justify-content-start mb-4">
  <%= link_to 'Create New Plan', new_plan_path, class: 'btn btn-success btn-lg' %>
</div>

<div class="mb-5">
  <h2>My Plans</h2>
  <div class="row">
    <% @plans.each do |plan| %>
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title"><%= plan.name %></h5>
            <p class="card-text"><%= plan.description %></p>
            <% plan_instance_user = current_user.plan_instance_users.joins(:plan_instance).find_by(plan_instances: { plan_id: plan.id }, completed: false) %>
            <% if plan_instance_user %>
              <%= link_to 'Continue Plan', plan_instance_path(plan_instance_user.plan_instance), class: 'btn btn-primary' %>
              <%= link_to 'View Plan Info', plan_path(plan), class: 'btn btn-secondary' %>
            <% else %>
              <%= link_to 'Start Plan', plan_instances_path(plan_id: plan.id), method: :post, class: 'btn btn-primary' %>
              <%= link_to 'View Plan Info', plan_path(plan), class: 'btn btn-secondary' %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<div>
  <h2>Browse Plans</h2>
  <div class="row">
    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Community Plan 1</h5>
          <p class="card-text">Description of Community Plan 1.</p>
          <%= link_to 'View Plan', plan_path(3), class: 'btn btn-primary' %>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Community Plan 2</h5>
          <p class="card-text">Description of Community Plan 2.</p>
          <%= link_to 'View Plan', plan_path(4), class: 'btn btn-primary' %>
        </div>
      </div>
    </div>
  </div>
</div>